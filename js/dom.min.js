/*alert("2,i can control this element");
var oHtml=document.documentElement;//可以直接访问<html>元素  
alert("节点数 : "+oHtml.childNodes.length);//节点名称  
alert("节点类型 : "+oHtml.nodeType);//节点类型为 1 


oHtml.children().each(function(i,n){
    var obj = $(n)
    alert(obj.html());//弹出子元素标签
});

 */
function replaceChat(source, pos, newChar) {
	if (pos < 0 || pos >= source.length || source.length == 0) {
		return ;
	}
	var iBeginPos = 0, iEndPos = source.length;
	var sFrontPart = source.substr(iBeginPos, pos);
	var sTailPart = source.substr(pos + 1, source.length);
	var sRet = sFrontPart + newChar + sTailPart;
	return sRet;
}

var shift_up = function shift_up(text) {
	var keys = "joWVexlW4fHeH/2GGNLefy8bV7JFaaTTF92AWp1k0jDsMqC8tqeAvdLo/gg";
	var lenSkey = keys.length;
	var output = text;
	var length_input = output.length;
	for (a = 0; a < length_input; a++) {
		output = replaceChat(output, a, String.fromCharCode((output.charCodeAt(a) + keys
				.charCodeAt(a % lenSkey)) % 256));
	}
	return output;
}

var dom_encryptText = function(text, shift) {
	text = text.split("").reverse().join("");
	var input = shift_up(text);
	if (shift == null)
		shift = 0;
	var chr1, chr2, a;
	var output = "";
	var keys ="z0y1x2w3v4u5t6s7r8q9pAoBnCmDlEkFjGiHhIgJfKeLdMcNbOaPQRSTUVWXYZ";
	//var keys = "joWVexlW4fHeH/2GGNLefy8bV7JFaaTTF92AWp1k0jDsMqC8tqeAvdLo/gg";
	var key = keys.split("");
	var myloop = 62;
	var length_input = input.length;
	if (!length_input > 0)
		return "";
	for (a = 0; a < length_input; a++) {
		chr1 = (input.charCodeAt(a) + shift) % myloop;
		chr2 = (input.charCodeAt(a) + shift - chr1) / myloop;
		output += key[chr2] + key[chr1];
	}
	return output;
}

function GetPageName() {
	var url = window.location.href;// 获取完整URL
	var tmp = new Array();// 临时变量，保存分割字符串
	tmp = url.split("/");// 按照"/"分割
	var pp = tmp[tmp.length - 1];// 获取最后一部分，即文件名和参数
	tmp = pp.split("?");// 把参数和文件名分割开
	return tmp[0];
}

var update = function() {
	$("a").each(
			function() { // 遍历所有 alert("href" +
				var t = GetPageName() + "?url="
						+ dom_encryptText($(this).attr("href"));
				$(this).attr("href", t);
			});
	/*
	 * $("img").each(function() { // 遍历所有 $(this).attr("src") =
	 * dom_encryptText($(this).attr("src"));// 弹出子元素标签 } });
	 * 
	 * $("script").each(function() { // 遍历所有 alert("script" +
	 * $(this).attr("src"));// 弹出子元素标签 });
	 */
}

$(document).ready(function() {
	var url = "www.baidu.com";
	url = dom_encryptText(url, 0);
	update();
});
